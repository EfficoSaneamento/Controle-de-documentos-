<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>EFFICO | Valida√ß√£o de Documentos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{
 margin:0;
 min-height:100vh;
 background:linear-gradient(135deg,#0b3c49,#0f6e7a);
 display:flex;
 align-items:center;
 justify-content:center;
 color:#fff;
}
.card{
 width:100%;
 max-width:420px;
 background:rgba(255,255,255,.08);
 backdrop-filter:blur(14px);
 border-radius:20px;
 padding:24px;
 box-shadow:0 20px 50px rgba(0,0,0,.35);
}
.logo{
 font-weight:700;
 font-size:20px;
 margin-bottom:10px;
}
h2{margin:10px 0;font-weight:600}
button{
 width:100%;
 padding:14px;
 border:none;
 border-radius:12px;
 background:#00d2c6;
 color:#003c3c;
 font-size:16px;
 font-weight:600;
 cursor:pointer;
 margin-top:10px;
}
button.sec{
 background:#ffffff22;
 color:#fff;
}
.hidden{display:none}

video{
 width:100%;
 border-radius:14px;
 margin-top:10px;
}
.overlay{
 position:absolute;
 inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 pointer-events:none;
}
.face{
 width:200px;
 height:260px;
 border:3px solid red;
 border-radius:50%;
}
.doc{
 width:260px;
 height:170px;
 border:3px solid red;
 border-radius:14px;
}
.ok{border-color:#00ffb3}
.status{
 text-align:center;
 margin-top:8px;
 font-weight:500;
}
input[type=file]{
 margin-top:10px;
 color:#fff;
}
</style>
</head>

<body>

<div class="card">
  <div class="logo">EFFICO</div>

  <!-- LGPD -->
  <div id="lgpd">
    <h2>Prote√ß√£o de Dados (LGPD)</h2>
    <p style="font-size:14px">
      Ao continuar, voc√™ autoriza a coleta e uso de seus dados pessoais
      exclusivamente para fins de admiss√£o, conforme a LGPD.
    </p>
    <button onclick="iniciar()">Aceitar e continuar</button>
  </div>

  <!-- Sistema -->
  <div id="sistema" class="hidden">
    <h2 id="titulo">Selfie</h2>

    <button onclick="abrirCamera()">üì∑ Tirar foto</button>
    <input type="file" accept="image/*" onchange="upload(this)">

    <div style="position:relative">
      <video id="video" autoplay playsinline muted class="hidden"></video>
      <div class="overlay hidden" id="overlay">
        <div id="guia" class="face"></div>
      </div>
    </div>

    <div class="status" id="status"></div>

    <button id="btnFoto" class="hidden" onclick="capturar()">Capturar</button>
  </div>
</div>

<canvas id="canvas" class="hidden"></canvas>

<script>
let etapa = 0;
const etapas = [
 { nome:'Selfie', tipo:'face' },
 { nome:'RG / CPF', tipo:'doc' }
];

const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const guia = document.getElementById('guia');
const status = document.getElementById('status');

function iniciar(){
 document.getElementById('lgpd').remove();
 document.getElementById('sistema').classList.remove('hidden');
}

async function abrirCamera(){
 video.classList.remove('hidden');
 overlay.classList.remove('hidden');
 document.getElementById('btnFoto').classList.remove('hidden');

 guia.className = etapas[etapa].tipo;
 document.getElementById('titulo').innerText = etapas[etapa].nome;

 const stream = await navigator.mediaDevices.getUserMedia({
   video:{facingMode: etapa===0?'user':'environment'}
 });
 video.srcObject = stream;

 validarLoop();
}

function validarLoop(){
 const w = video.videoWidth;
 const h = video.videoHeight;
 if(!w) return requestAnimationFrame(validarLoop);

 // simula√ß√£o realista de dist√¢ncia
 const area = w*h;
 if(area < 150000){
   guia.classList.remove('ok');
   status.innerText = 'Aproxime-se';
 }else if(area > 600000){
   guia.classList.remove('ok');
   status.innerText = 'Afaste-se';
 }else{
   guia.classList.add('ok');
   status.innerText = 'Posi√ß√£o correta';
 }
 requestAnimationFrame(validarLoop);
}

function capturar(){
 if(!guia.classList.contains('ok')) return;

 const canvas = document.getElementById('canvas');
 canvas.width = video.videoWidth;
 canvas.height = video.videoHeight;
 canvas.getContext('2d').drawImage(video,0,0);

 if(etapas[etapa].tipo==='doc'){
   ocr(canvas);
 }

 avancar();
}

function upload(input){
 if(!input.files[0]) return;
 if(etapas[etapa].tipo==='doc'){
   const img = new Image();
   img.onload = ()=>ocrImagem(img);
   img.src = URL.createObjectURL(input.files[0]);
 }
 avancar();
}

function avancar(){
 const tracks = video.srcObject?.getTracks();
 tracks && tracks.forEach(t=>t.stop());

 etapa++;
 if(etapa>=etapas.length){
   alert('Processo conclu√≠do');
   return;
 }
 abrirCamera();
}

function ocr(canvas){
 Tesseract.recognize(canvas,'por').then(r=>{
   console.log('OCR:',r.data.text);
 });
}
function ocrImagem(img){
 const c=document.getElementById('canvas');
 c.width=img.width;c.height=img.height;
 c.getContext('2d').drawImage(img,0,0);
 ocr(c);
}
</script>

</body>
</html>



