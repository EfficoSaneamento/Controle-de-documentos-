<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RH Digital - EFFICO</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
:root{
  --green:#00c853;
  --red:#d32f2f;
  --bg:#f2f4f7;
}
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  padding:20px;
}
.container{
  background:#fff;
  max-width:420px;
  width:100%;
  border-radius:20px;
  box-shadow:0 12px 30px rgba(0,0,0,.15);
  padding:24px;
}
.logo{width:110px;margin-bottom:10px}
h1{margin:0 0 20px;font-size:1.3rem;color:#003399}

.status{
  background:#eef3ff;
  padding:12px;
  border-radius:10px;
  font-size:.9rem;
  margin-bottom:15px;
}

.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:1rem;
  font-weight:bold;
  cursor:pointer;
}
.btn-primary{background:var(--green);color:#fff}
.btn-outline{
  background:#fff;
  border:2px solid var(--green);
  color:var(--green);
  margin-top:10px;
}

.camera-box{
  position:relative;
  width:100%;
  aspect-ratio:4/3;
  background:#000;
  border-radius:16px;
  overflow:hidden;
  margin:15px 0;
  display:none;
}
video{
  width:100%;
  height:100%;
  object-fit:cover;
}

#overlay{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:70%;
  height:75%;
  border:3px solid var(--red);
  border-radius:18px;
  box-shadow:0 0 0 9999px rgba(0,0,0,.55);
  transition:.3s;
}

.selfie #overlay{
  border-radius:50%;
}

.hidden{display:none}
canvas{display:none}
</style>
</head>

<body>
<div class="container">

<img src="https://effico.com.br/wp-content/uploads/2022/06/Sem-Titulo-7123.png" class="logo">
<h1>RH Digital</h1>

<div id="lgpd" class="status">
Ao continuar, você autoriza o tratamento dos seus dados conforme a
<b>LGPD (Lei 13.709/2018)</b>.
<br><br>
<button class="btn btn-primary" onclick="aceitarLGPD()">Aceitar e iniciar</button>
</div>

<div id="status" class="status hidden"></div>

<div id="cameraBox" class="camera-box">
  <video id="video" autoplay muted playsinline></video>
  <div id="overlay"></div>
</div>

<div id="acoes" class="hidden">
  <button class="btn btn-primary" onclick="abrirCamera()">Tirar foto</button>
  <button class="btn btn-outline" onclick="anexar()">Anexar imagem</button>
  <input type="file" id="file" class="hidden" accept="image/*">
</div>

<button id="enviar" class="btn btn-primary hidden" onclick="enviar()">Enviar documentos</button>

</div>

<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

<script>
const etapas=[
 {label:"Selfie",key:"selfie",mode:"user",tipo:"selfie"},
 {label:"RG Frente",key:"rg_frente",mode:"environment"},
 {label:"CPF",key:"cpf",mode:"environment"},
 {label:"CNH",key:"cnh",mode:"environment"}
];

let idx=0;
let fotos={};

const video=document.getElementById("video");
const overlay=document.getElementById("overlay");
const cameraBox=document.getElementById("cameraBox");
const status=document.getElementById("status");

async function aceitarLGPD(){
 document.getElementById("lgpd").remove();
 status.classList.remove("hidden");
 await faceapi.nets.tinyFaceDetector.loadFromUri(
  "https://justadudewhohacks.github.io/face-api.js/models"
 );
 proximo();
}

function proximo(){
 if(idx>=etapas.length){
   status.innerText="Processo concluído";
   document.getElementById("enviar").classList.remove("hidden");
   return;
 }
 status.innerText="Documento: "+etapas[idx].label;
 document.getElementById("acoes").classList.remove("hidden");
}

async function abrirCamera(){
 const etapa=etapas[idx];

 cameraBox.classList.remove("hidden");
 cameraBox.classList.toggle("selfie",etapa.tipo==="selfie");

 const stream=await navigator.mediaDevices.getUserMedia({
   video:{facingMode:etapa.mode}
 });
 video.srcObject=stream;

 if(etapa.tipo==="selfie") detectarRosto();
 else capturarDepois(2000);
}

async function detectarRosto(){
 const interval=setInterval(async()=>{
  const face=await faceapi.detectSingleFace(video,new faceapi.TinyFaceDetectorOptions());
  if(face){
   overlay.style.borderColor="var(--green)";
   clearInterval(interval);
   capturar();
  }else{
   overlay.style.borderColor="var(--red)";
  }
 },700);
}

function capturarDepois(ms){
 setTimeout(capturar,ms);
}

function capturar(){
 const canvas=document.getElementById("canvas");
 canvas.width=video.videoWidth;
 canvas.height=video.videoHeight;
 canvas.getContext("2d").drawImage(video,0,0);
 fotos[etapas[idx].key]=canvas.toDataURL("image/jpeg");
 if(video.srcObject) video.srcObject.getTracks().forEach(t=>t.stop());
 idx++;
 cameraBox.classList.add("hidden");
 proximo();
}

function anexar(){
 document.getElementById("file").click();
}

document.getElementById("file").onchange=e=>{
 const reader=new FileReader();
 reader.onload=()=>{
  fotos[etapas[idx].key]=reader.result;
  idx++;
  proximo();
 };
 reader.readAsDataURL(e.target.files[0]);
};

function enviar(){
 status.innerText="Enviando...";
 console.log(fotos);
}
</script>
</body>
</html>




